<div class="page-container">
    <div class="card table-card">
        <div class="card-header-internal">
            <div class="title-group">
                <h1>Historique des Prises en Charge</h1>
                <p class="subtitle">Suivi et historique des demandes de prise en charge</p>
            </div>
            <button class="btn btn-primary" (click)="goToCreate()">
                <i class="fas fa-plus"></i> Nouvelle PEC
            </button>
        </div>

        <div *ngIf="errorMsg" class="alert alert-danger">
            {{ errorMsg }}
        </div>

        <div class="loading" *ngIf="loading">Chargement...</div>

        <div class="table-responsive" *ngIf="!loading">
            <table>
                <thead>
                    <tr>
                        <th>N° PEC</th>
                        <th>Employé</th>
                        <th>Centre</th>
                        <th>Statut</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let p of prises" class="clickable-row">
                        <td><span class="ref-code">{{ p.pec_num }}</span></td>
                        <td>
                            <div class="employee-cell">
                                <span class="emp-name">{{ p.nom_emp }} {{ p.prenom_emp }}</span>
                            </div>
                        </td>
                        <td>{{ p.cen_nom || 'Non assigné' }}</td>
                        <td>
                            <span class="status-badge"
                                [class.valid]="p.pec_approuver === true || p.pec_approuver === 't'"
                                [class.pending]="p.pec_approuver === false || p.pec_approuver === 'f' || !p.pec_approuver">
                                {{ (p.pec_approuver === true || p.pec_approuver === 't') ? 'Valide' : 'Non valide' }}
                            </span>
                        </td>
                        <td class="text-end">
                            <button class="btn-icon" (click)="goToDetail(p.pec_code!)" title="Voir détails">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                    width="20" height="20">
                                    <path
                                        d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                    <tr *ngIf="!prises.length">
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-file-medical-alt"></i>
                            <p>Aucune prise en charge trouvée</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>